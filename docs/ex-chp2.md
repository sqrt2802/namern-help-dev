![image](https://github.com/user-attachments/assets/5981b20f-7a08-4485-b2d7-67bf66f5a4a4)# Chapter 2 一些大工具

假如你选择了跳过 Chapter 1，那么请严格遵守本篇教程这些工具使用时的推荐数值以及用法，即使你不明白为什么。如果你没跳过 Chapter 1，但是仍然不知道为什么，那也请遵守对这些工具使用时的推荐数值。或许你在看到 Chapter 3 的时候会明白的。

## 2.1 pbb 测号器

### 为什么选择 pbb 测号器？

（可能并不）众所周知，`魂魄妖梦 AKG1OENX@Squall` 是八围不到 650 的“无表号”，但是它的强评高达 6595，一度在榜单上排名强评第一好几个月。而此号的测出，得益于由曙光和 pl 最初撰写，由 Squall 和曙光进行进一步改良的 pbb 测号器。

在使用 pl 测号器的过程中，由于降低八围阈值意味着需要多测更多占比的虚评，进而会导致速度下降，很少有人会将八围阈值降得如此低，那么，是否就有可能错过这样的超级强号？<br>
不如来使用 pbb 测号器，采用全新一代曙光筛2.0，帮助你更好地进行筛号，提高过虚评的号的质量，节省时间成本，寻找超级强号！

pbb 和 pl 测号器相比的优势：

- 采用全新曙光筛，在几乎不损失速度的前提下更不容易漏号。
- 内置新版虚评（1015版），虚评更准确，也不需要先设置低的旧版阈值然后再过一遍新版，一步到位。同时也能增加虚单阈值。
- 有单开多线程的功能，为不会自己手写一键多开的玩家提供便利，而且更加稳定。
- 可以测的格式和字符集更加丰富多彩。
- 可以测号的同时顺便收集属性稀有 ID（比如八围最高、华丽 ID 等等）。
- 多线程测号时输出全在一个文件中，方便查找和汇总。
- pl 测号器的名字有长度限制，而 pbb 测号几乎没有。
- 用每 1e6 个号制定 task 分配给线程的方案，使得测顺序的多开时变得方便（不需要预估需要多久才能测完，可以随时开随时关，从上一次的起点开始即可）。
- 可以随时改变开的线程数，在需要操作电脑时降低线程数，等操作完了再提升回去，比较方便。

### pbb 测号器的用法

pbb 测号器不提供源码。

**请尽量选择最新的测号器，截止这段教程最后更新（20250420）时最新的测号器为 pbb5.2.1**

推荐使用 pbb 测号器而非 pl 测号器，写入门教程的时候 pbb 测号器并没有像现在这样完善。

这个测号器称为 pbb 测号器的原因是它是在【早期 pbb 测号器】的基础上改造的，虽然实际上代码已经相差甚远，甚至有可能已经忒修斯之船了。

这里介绍一下 pbb 测号器的用法。

直接去看 `files` 里的 `pbb` 文件夹。

它应当包含这些东西

- out 文件夹
- 三个 dll 文件
- 一个 exe 文件

除此之外（这是建议），由于 pbb 的输入比较繁琐，你应该再建一个 `input.txt` 或者其他文件名的文件，用于储存你的输入是怎样的，下次再输入的时候只需要打开 exe 再进行复制即可。

接下来并不简要地介绍一下 pbb 的输入参数。

```text
hanzo_cnt_3=6400
hanzo_cnt_4=64287
```

首先前两行是调试信息，你不需要管。（甚至把 hanzi 打成了 hanzo）

```text
是否开启 DEBUG 模式？是否关闭在线线程修改？（输入 0/1/2/3）
输入 0 表示关闭 DEBUG 模式，开启在线线程修改
输入 1 表示开启 DEBUG 模式，开启在线线程修改
输入 2 表示关闭 DEBUG 模式，关闭在线线程修改
输入 3 表示开启 DEBUG 模式，关闭在线线程修改
```

DEBUG 模式是在有人反馈测号器出 bug 的时候让他开启然后告诉开发者输出信息的东西，建议别开，只选择 0 或者 2。区别在于能否动态改变线程数。

输入 0 的话，作用是，比如说你接下来一段时间随时可能需要用电脑，这样的话用电脑的时候就把线程数调低甚至设为 0，不用的时候然后再重新修改线程数，比较方便。注意输入的线程数不能超过最开始开的线程数，否则会无效。

输入 2 就不能修改线程数了，但是速度会稍微快一点点（几乎可以忽略）。

```text
使用说明：使用前现在同目录下建一个名为 out 的文件夹
假如显示缺少 dll 就把 pl 测号器的那几个复制过来
请输入队名：
输入一个 @ 表示自行输入编码转换后的结果
```

字面意思，输入队名。注意到测号器在终端打开，默认 ANSI，也就是说有些奇怪的队名（比如某些 Unicode，如 emoji 字符），无法直接输入，所以才有 `输入一个 @ 表示自行输入编码转换后的结果` 这行字。如果队名比较正常直接输入即可，否则输入一个 `@`。

输入 `@` 后会出现 `输入转化编码后的长度`，这里的编码是 utf-8 编码。如果你不知道怎么转化编码，那就不要搞这种东西了。比如黄瓜 emoji 字符的编码是 `-16 -97 -91 -110`（或者 +256 后的结果），那么你就应该输入 4。 `输入转化编码后的每个数字`，我知道很多转换会给你输入 0~255 内的数字，但是还是请你输入 -128~127 内数字，因为这是 unsigned char 和 int 直接转换的结果。

随后会出现一行数字，表示你输入的战队名转换后的数字，后面如果有多余的 0 不用管，可以自行检验一下。

```text
输入前缀数量（无前缀也要输入 1 ）
```

为了方便一些人对同时测多个前缀后缀的需求，开发了多前缀后缀模式。  
意思是，在字符集和长度相同的情况下，你可以同时测多个前后缀。  
比如你有几十个前缀想测（这些前缀可能是一些系列之类的）但是担心自己无法较为均匀地分配测号量，你可以输入 20。

```text
输入第 1 个前缀（如果无前缀输入一个单独的加号）：
输入一个 @ 表示自行输入编码转换后的结果
```

字面意思。如果前缀为空字符串那么就输入一个单独的 +，其他和输入队名时的情况一样。

```text
输入后缀数量（无后缀也要输入 1 ）
```

后缀同理。目前不支持中缀。

```text
注意！拉丁字母、盲文字母、扩展汉字在 GB2312 编码中不存在，只能使用直接 UTF-8 输出，有一定风险，谨慎使用！
注意！拉丁字母、盲文字母、扩展汉字在 GB2312 编码中不存在，只能使用直接 UTF-8 输出，有一定风险，谨慎使用！
注意！拉丁字母、盲文字母、扩展汉字在 GB2312 编码中不存在，只能使用直接 UTF-8 输出，有一定风险，谨慎使用！
注意！“全部汉字”也有部分在 GB2312 编码中不存在，也只能使用直接 UTF-8 输出！
注意！“全部汉字”也有部分在 GB2312 编码中不存在，也只能使用直接 UTF-8 输出！
注意！“全部汉字”也有部分在 GB2312 编码中不存在，也只能使用直接 UTF-8 输出！
```

这段话有点过时，但是开发者懒得改了。这段话的意思是，推荐只使用 utf-8 编码输出。因为很多后续的工具是需要直接读入 utf-8 编码的。

```text
请输入字符集中单个字符的长度：
```

字面意思，普通的 ascii 字符长度为 1，希腊字母之类的长度为 2，汉字之类的长度为 3，想要什么字符集自己去查。
当然也可以自定义一些奇奇怪怪的字符集，比如说所有大写字母后面加一个中文感叹号，这个字符集的单个字符长度就为 4。
目前不支持字符集里存在长度不一样的字符。

输入完字符集里单个字符长度后，会跳出来一些东西，这里以 2 为例。

```text
有以下几种字符集供选择，可以进行任意组合
1. 小写希腊字母（24个）
2. 大写希腊字母（24个）
3. 小写俄文字母（33个）
4. 大写俄文字母（33个）
5. 小写拉丁字母（31个）
6. 大写拉丁字母（31个）
7. 自定义（自己输入编码转换后的结果）
8. Unicode 转码（自己输入区间）
请输入你选择几种进行组合
```

对于长度为 1 2 3 4 的字符集，预设了一些你可能会需要用到的字符集，当然如果没有的话你也可以自行输入。

首先你得输入以上的几种进行组合，比如说我想要大小写希腊字母作为字符集，那就输入 2。

```text
请输入你选择进行组合的字符集编号
```
输入那些编号即可。比如 1 2。

如果你需要的字符集并不在预设的范围内，你可以输入 7 或者 8。**注意这两个不要同时输入，且如果和其他的一起输入的话，放在最后！**

如果你输入 7 那就按指示做，不再赘述了。如果你输入 8：

```text
你输入的区间应当为 10 进制而非 16 进制
例如 U+0080 到 U+07FF 你应当输入 128 2047
考虑到有可能不连续区间的可能，你需要先输入区间数量
```

接下来你需要输入区间数量，如果 Unicode 编码是一段连续的区间那就输入 1 即可，如果不是，那就有几段就输入几段。

```text
请输入区间 [l,r]，最大区间范围为 128 到 2047（U+0080 到 U+07FF）
```

自行查阅你想选的字符集的 Unicode 编码范围，这里不再赘述。这个 128 和 2047 会随你输入的字符集单个字符长度变化而变化。

```text
是否需要检查字符集？
输入 0 表示不需要，输入 1 表示显示在屏幕上，输入 2 表示输出在一个名为 charset.txt 的文件里，输出 3 表示直接输出 UTF-8 编码到文件里
```

如果你不放心自己输入的字符集对不对，那你可以检查一下。如果字符集涉及到非 ANSI 的字符的话那只能选 3。否则的话选 1 或者 2 或者 3 都可以。

```text
请选择枚举模式：
1. 顺序
2. 随机，随机方式是随机若干个长度为 1e6 的区间进行顺序
3. 随机，随机方式是按位随机
4. 随机，随机方式是随机若干个长度为 1e6 的区间进行顺序，且前缀和后缀一一对应

注意：多前缀的顺序模式将会枚举前缀测完顺序，后缀取模滚动
即测号数量为测号区间大小乘前缀数量，和后缀数量无关
```

不推荐选 3，所谓“随机若干个长度为 1e6 的区间”你就理解成和按位随机效果差不多就行了。2 会比 3 快一些。

这里说一下 2 和 4 之间的区别。在单前后缀的时候 2 和 4 没区别。多前后缀的话，2 会随机选一个前缀，然后随机选一个后缀，4 会随机选一个前缀，然后选编号和这个随机选的前缀相同的后缀。<br>
意思就是，如果你的前缀和后缀是一一对应的，你应该选择 4，否则选择 2。

顺序也可以使用多前缀后缀。用于，比如你有很多前后缀格式，但是每个格式需要的测号量相对较少的情况。前缀和后缀也应该是一一匹配的。

```text
输入可变长度：
```

字面意思。就你的格式中，你输入的字符集罗列几个，比如说我的格式是 `前缀XXXXXXXXXX后缀@队名`，X 为任意字母数字，那么就输入 10。


如果你选择的是随机模式：

```text
输入总数（如果输入 -1 表示 1e18）：
```

如果不知道自己到底打算测多少可以输入 -1，等想停的时候直接关掉。但是无论如何你输入的值应当至少以亿作为单位（很多时候是万亿），不要输一个小不拉几的数。

如果你选择的是顺序模式：

```text
输入区间方式说明：你输入的区间总数应当与输入的前缀数匹配。
为了简化输入，采用可以一次性输入多个前缀组的方式。
每一组区间 (n,[l,r)) 表示接下来 n 组区间都是 [l,r)
输入区间组的数量：
```

搞这种东西是为了方便之前所说的多前缀后缀的测号格式。正常来说你需要对每一个前后缀格式输入一个区间，但是考虑这个区间有可能有大量重复，所以增加了可以一次性输入多个区间。

比如你想要前 50 个都测 0~1000000000，后 50 个都测 0~30000000000，那你就输入

```text
2
50 0 10000000000
50 0 30000000000
```
即可。

```text
输入虚评阈值和虚单阈值，关系为或：
```

这里你需要输入两个数。  

推荐阈值：xp 4900~5000 xd 5600~6000。

值得注意的是对于某些特殊类型的号（指分身护符魅惑苏生），会将 xp 阈值自动降低 300（这个东西写在代码内部了）。至于原因，你将会在第三节看到。

需要注意的是，你并不需要将输出的号全部“开箱”。而是应该将他们放进 2.3 会提及的工具，data_structure 工具的输入中。你需要开箱的号的阈值可以适当提高。

```text
是否收集特殊属性号（输入 0 表示否，输入 1 表示输出破纪录的号，输入 2 表示自己设定阈值）：
是否在输出文件中显示虚评虚单：（0 表示否，1 表示是）：
是否在将 UTF-8 编码直接输出：（0 表示转换为 GB2312 编码，1 表示是，建议不懂的人选 0）：
是否将 task 完成情况的日志输出在文件中(0 表示输出在文件里，1 表示输出在屏幕上
是否将速度显示输出在文件中(0 表示输出在文件里，1 表示输出在屏幕上
```

推荐 1 0 1 1 1。

特殊属性号指的就是八围最高之类的，假如你输入 2 你自己看吧。<br>
不建议在输出文件中显示虚评虚单，因为很多后续工具需要纯粹的号作为输入。<br>
忽略“建议不懂的人选 0”这句话，只是忘记删了而已。后续很多工具需要 utf-8 编码的原号文件。<br>
后两个东西显示在屏幕上应该更好一些。

```text
输出文件的文件名
输入 + 生成一个随机文件名，输入 - 生成一个关于时间戳的文件名
```

输出会以 append 的形式追加到新的文件中，不需要担心被覆盖。<br>
你可以输入 `out-格式.txt` 之类的，或者单纯地输入 `+` 或者 `-`。

```text
输入你要开的线程数：
```

自己查看自己电脑的 cpu 型号，看看有几个核，几个线程可以用。名竞群其他群友一般推荐 总线程数-2 之类的，但是也可以直接输入总线程数。如果不想开满也可以输入更低的数。

随后会输出几个号让你看一下格式大概是怎样的，即，看看你的格式有没有搞错。但是如果你的字符集包含非 ANSI 的字符可能会显示莫名其妙的东西。

然后如果你按前面说的选择显示在屏幕上的话，大概会跳出来类似这样的东西。

```text
task90 finished,task_mex=92,count:0.000100T
tot=14, (739,5348,4995),time: 11.29s, speed: 0.765482T/d,time left:6h32m39s
```

再等一点还会有类似这样的东西。

```text
cur_speed:0.877264T/d,time left(?):4h1m0s
```

简要说一下 pbb 多线程的原理。他创建了多个线程。将测号任务以 1e6 为单位分割成任务，然后每个线程会接收任务，当自己这边的任务执行完了之后会继续接收新的任务。所以这个 task90 finished 就是第几个任务被完成了。注意到完成任务的顺序并不一定完全就是布置任务的顺序。

然后 task_mex 就是最小的还没有被执行完成的任务，如果有强迫症认为必须每一个号都被枚举，那么测顺序的时候可以通过这个来计算最多从哪里开始就一定没有漏的。count 就是字面意思，你目前测了多少号。T 是 $10^12$。

tot 就是目前过筛的输出的号。这个括号里的三个数字是，测到现在为止，最高的某项数值。分别是 八围 虚评 虚单的最高值。 time 就是已经过去的时间，speed 就是估计速度（这个是从开始到现在的平均速度），time left 就是，根据你输入的测号量以这个速度估计还需要多久才能测完。

但是注意到 speed 是平均速度，可能你最开始的时候出了点什么事情导致速度很慢，现在调回正常了，但是平均速度依然会算之前的那段时间，这样会导致不太准确，所以有 cur_speed，更接近所谓的瞬时速度。表示最近 0.001T 内的平均速度。

这里顺便一提，假如你发现你的平均速度突然骤降，那么很可能是中间经过了很长一段时间都没有进行有效的测号，但是用的时间已经算在内了。

最终输出号的结果在 out 文件夹内，文件名就是你在程序中输入的文件名。

## 2.2 node 开箱器

严格来说核心技术是一个提供了接口的 js 文件（`md5.js`）。<br>
示例用法放在 `example.js` 里了，想要自行开发的话视情况自行调用。<br>
**注意：这个东西运行后有内存泄漏的风险，想要自行开发的一定要留意这一点！！！** <br>
**diy 在一些时候并不完全准确，比如分身号在 diy 后疑似会变弱！！！**

在某次 windows 更新后各种浏览器被加了严重的资源限制导致开箱无法正常进行，因此该技术被开发，用于进行各类需要快速统计战斗的场景。

输入和输出文件应当在和 `node.exe` 同一个目录下。输入和输出的文件名可以自定义，个人推荐用 `input.txt` 和 `output.txt`。有什么个性化需求可以自行修改相应的 `.js` 文件（如 `cqp.js`）。

需要注意的是，由于 cpp 生成的可执行文件本身无法控制 cmd 创建的 `node.exe` 的多线程调度（尤指输出的原子性），我将输出按照文件放在了 `out` 文件夹下，每次子线程只**以追加形式**输出在自己对应的那个文件里。最后你需要双击运行 `merge_files.bat`，然后输入你想要汇总到哪个文件（如 `output.txt`），进行汇总。<br>
这也意味着你如果不清理 `out` 文件夹，会导致几次输入的结果混在一起。几个可执行文件的开头都放了清空 `out` 文件夹的选项，既是方便地进行清空，也有提醒的作用。当然如果你认为不应该清空可以选择不清空。<br>
同时由于进行多线程的原理是将大文件拆成多个小文件存在 `tmp` 文件夹里再让 `node.exe` 去读取，这会导致你**无法**在一个 `node-openbox` 文件夹内同时运行多个 exe，会出较为严重的 bug。

```text
在开始前，是否需要清空 out 文件夹(0/1)
注：我会采用删除整个文件夹再创建这个文件夹的方式
```

输入 0 表示不清空，输入 1 表示清空。

### openbox

这里是开箱功能，指官方评分。你可以修改 `openbox.js` 来自行设计你想要的功能。

```text
输入类型（pp/pd/qp/qd/all，输入两个字母而不是第几个）：
输入准确度：
```

all 是三个字母，不过无伤大雅。<br>
前四个的输出格式都会是 分数 名字 然后换行的形式，输入 all 则表示四个都测，然后先输出四个分数再输出名字。<br>
准确度表示进行前多少**百**场战斗然后算平均值，比如输入 100 表示一万场战斗，精确到四位有效数字，这个和测官方评分时的 100% 是一致的。<br>
你输入的准确度可以不局限于 10 的幂次，比如 4,30 之类的，但是不能是小数。

```text
输入输出在文件中的阈值：
输入输出在屏幕上的阈值：
```

类型为 `all` 的时候阈值为强评的阈值。<br>
考虑到有些人是急急国王（比如开发者），很想在整个测号任务完整测完前就得知一部分强号的信息，提供了输出在屏幕上的阈值这一个东西。<br>
开发者的建议是，你的这个阈值应当 >= 输出在文件中的阈值，毕竟设计出来只是为了方便你偷看一部分强号的数值的。

```text
输入总号量：
输入输入文件名：
```

你需要输入你测的总号量，以及**输入文件**的文件名，包含后缀（如`.txt`），输出文件名并不会再这里输入，而是在 `merge_files.bat` 里输入！<br>
输入文件内的输入格式为每个号结尾换行。<br>
Q: 为什么需要输入总号量，但是 XP 和 convert 之类的就不需要？<br>
A: 为了实现方便，解释起来比较复杂，不解释了。归根到底就是实现比较狂野且懒得改进。

你也可以输入 diy 格式的号进行评测。同时也可以输入多人组。为了与 diy 格式兼容，多人组连接应当用 `++` 连接。

```text
是否将 task 完成情况的日志输出在文件中(0 表示输出在文件里，1 表示输出在屏幕上
是否将速度显示输出在文件中(0 表示输出在文件里，1 表示输出在屏幕上
输入你要开的线程数：
NUMBER_OF_WORKER_THREAD is XX
每个 task 的测号量：
每测多少个 task 计算一次 cur_speed
```

前两个类似 pbb，如果想要更方便地看速度的话建议都选 1。线程数按照你电脑的 CPU 来，也可以适当降一些。<br>
每个 task 的测号量就自己定吧。不建议太大，会因为内存泄漏导致超过电脑内存限制从而闪退甚至重启。但是太低的话会在来回切换上耗费一定的时间从而浪费算力。<br>
个人推荐批量测 100% 数值时的每个 task 测号量在 10~20 左右。<br>
每测多少个 task 计算一次 cur_speed 推荐为线程数的整数倍，或者直接就是线程数即可，不然在前几批 task 会忽上忽下算不准确。

```text
是否将过筛的号显示在屏幕上(0/1)
```

你可以选择关闭输出在屏幕上这一选项，不过这个本身可以在输出阈值的时候选择 10000 之类的来实现，这个只是以防万一。

### cqp

这里是超强评功能，包含超强单，用于测试你的号/组合对指定的一些号/组合（被称为“靶子”）的平均胜率，以便更科学地反映强度。你可以修改 `cqp.js` 来自行设计你想要的功能。

只讲述和 openbox 不一样的。

```text
输入类型(1/2)：
```

这个类型表示人数。1 表示测超强单，2 表示测双人组超强评。二人组的格式应当为 `name1@team+name2@team`，然后换行。

```text
每个 task 的测号量：
```

推荐 1% 选 20-50，10% 选 3-5，100% 选 1-2。

```text
是否将每一组的胜率显示在屏幕上(0/1)（强烈建议在多线程的时候不要使用！）
```

这个指的是，是否将对靶子里的每一个/每一组号的胜率都输出到屏幕上。若在多线程的时候使用会全部混在一起看不清，所以不要在多线程的时候使用。不过在单线程的时候使用可以让你更清楚的看到输入对各个类型的号/组合的胜率。

额外提一嘴，修改 `cqp.js` 的空间其实要比 `openbox` 大。主要是你可以修改靶子本身，定制个性化的平均胜率，还可以将对每一组的胜率输出到文件中，这样多线程也不会混在一起。

**修改靶子**

在 cqp.js 中，在 `if (team_size == X)`（X 为 1 或 2）后，会有 `target = [...]` 的语句，如果想要修改靶子，你只需要改变里面的内容。每个号/组合开头和结尾加引号，然后加逗号。**注意有些字符在代码里不应该直接输入，需要将一些字符的前面加上转义字符（两个斜杠符号），如引号、斜杠等。** 不然会导致号不正确甚至编译错误。

**关于 diy cqp**

有些情况下你可能想要测使用了 diy 的二人组，那你可以选择 `diy-cqp.exe` 输入的时候两个号都用 diy 格式，中间用 `++` 而不是单个 `+` 连接。<br>
注意！！！使用了 diy 后的二人组不会再有加成！（你本来就是应当是为了排除加成的影响，不是吗？）

### pair

这里是实战组队评分功能。你可以修改 `pair.js` 来自行设计你想要的功能。

结合第三章看效果更佳。

我们发现目前的二人组绝大部分可以被划分为一定的类型，具体来说，粗略地可以分为**有刺**、**传统无刺**（简称**无刺**）、**人海**。其中人海又可以细化地分为魅惑、分身、幻术等，但更多的是杂糅，难以明说到底是什么组合，甚至会和有刺和传统无刺杂糅。

目前有关人海领域的研究尚浅，让我们暂时把目光聚焦到有刺和传统无刺上来。我们认为，有刺组合分为辅助和背刺，而无刺的“分工”则并没有那么明确。

背刺的技能主要是潜行，可能会有少量其他主动技能，被动技能不论，但通常认为有吞噬、亡灵等的较佳。护盾这个被动技能则争议比较大，这里不再细究。辅助则通常包括铁壁、加速、减速、冰冻、净化、护符、守护**等**。无刺通常包括地裂、瘟疫、净化、连击、诅咒、铁壁**等**。辅助和无刺的范畴非常广泛，基本上可以认为不是背刺的号都**有可能**称为辅助或者无刺，包括一些人海号。

仅仅看强评是不够的，为了更好地衡量背刺、辅助和无刺**在无加成情况下**的组队强度，我们想到了这样的办法：对于一个**指定类型的号**，选取一系列基准号（通常是选择玩家中的号比较强的一些，由于历史原因也会称为“靶子”，一般在语境下不会与超强评对手的“靶子”搞混），全部配一遍，测 10% 的超强评（当然也可以先测更低的作为初筛），然后取前若干相加。

比如说，要测这个号的“辅评”（即辅助评分），我们就把背刺基准挨个和这个号配，测超强评，然后选取最高的三个相加。测“刺评”就选其他辅助，测“无刺”就选择其他无刺。有个历史遗留称呼的问题，由于最开始测无刺只用了地裂号（当时认为能配无刺的基本都能和地裂配，实际上直到现在反例也较少），所以通常称为“地评”。

```text
输入类型(1/2/3)，分别表示辅评（+背刺）、刺评（+辅助）、地评（+地裂）：
```

字面意思，你的输入文件里应当只包含一种类型的号，并且输入。<br>
**如果基准号中有输入号的同队的号，你应该采用 diy 格式输入，否则可能会因为有加成而不准确！**

```text
每个 task 的测号量：
```
推荐 1% 选 10-20，10% 选 1-2。

```text
是否将每一组的胜率显示在屏幕上(0/1)
```

在这里这个“每一组胜率”指的是每一个和基准号配胜率得到的超强评。

**由于负责更新 pair 基准号的曙光鸽子了，目前 pair 的基准号相对过时，到时候如果有更新了记得更换！**

### 使用小技巧

#### 自动调优先级

由于 Windows 的某次神秘更新，优先级不调到“高于正常”的程序将无法占用超过 50 的 CPU（好像只对 Intel cpu 是这样的）。但是 `node.exe` 是即时创建和关闭的，因此没法手动一个个调优先级，而且本身也太繁琐了！

解决方法：

```batch
echo off
:loop
wmic process where "name='node.exe'" call setpriority 32768 >nul 2>&1
timeout /t 20 /nobreak >nul
goto loop
```

将以下代码存入一个 `.txt` 文件并改后缀名为 `.cmd`，然后放到 `node.exe` 的 **上级目录**，然后运行。效果是每 20 秒扫描一遍正在运行的进程，然后把 `node.exe` 全部优先级调为“高于正常”。你也可以修改这个“20”。

#### 排序

要测的东西太多了，花的时间太长怎么办？你可以提前将你想要测的东西按照某些模型评分（无论是什么，比如虚评之类的）排序再开始测。测了一段时间后你觉得差不多了，再测下去也只是浪费时间，那可以提前结束掉，可以在最大程度上减少损失。

#### 复制整个文件夹

之前说到由于实现原因，你无法实现在同一个 node-openbox 文件夹里运行多个脚本，但是你可以将整个文件夹复制一份，然后在不同的文件夹内分别运行，这样就不冲突了。

## 2.3 Data\_Structure 配队器

感谢【黄瓜/🥒】的贡献，这部分内容是在他写的稿子的基础上稍微修改润色而成的。

Data\_Structure 是在 刺评/辅评/地评 等基于 cqp 的评分模型的基础上开发的二人组一键配队整合包。<br>
叫 Data\_Structure 的原因是它是用来处理大规模数据的，刚好群内（前）算法竞赛选手比较多，然后就叫这个名字了。

可以简称为 DS 或 ds。

目前该整合包完全开源，如果你拥有编程基础，可以前往 `src` 文件夹修改源代码以 diy。

- tips：根目录下存在一键编译的 bat 文件。

### 一键配队

如果你不想知道的太多，你可以只看这一步。请按顺序进行如下步骤：

0\. 检查 `Regular` 目录下 `config.txt`，pbb 几开就把第五行设为几。同时将 678 行的第一个数依次改为 1 1 0。检查 `Many` 目录下的 `config.txt`，pbb 几开就把第五行设为几。同时将 4 5 行的两个数改为 1，将 6789 行的数依次改为 1 0 1 0。
   - 不进行这步，可能会导致电脑卡，或 out 文件无文件。

1\. 将号库文件放入根目录下 `input` 文件夹。

   - 注：号库文件指包括垃圾堆的全号库。格式要求号后无 xp xd 评分，一行一个。
   - **注意，保证你的输入是 utf-8 格式！！！**

2\. 在根目录下运行 `run.bat`。

   - 如果是第一次运行，可能需要比较久的时间。

3\. 当 `run.bat` 控制台窗口消失，前往根目录下 `Regular` 和 `Many` 的 `out` 文件夹，得到 `FC.txt WC.txt FS.txt HS.txt` 四个文件，分别代表 辅助+背刺、无刺类型、分身+分身配件、幻术+幻术配件二人组枚举出的组合。

   - 文件内的格式应当为，每一行 `<score> <name1>+<name2>`。

4\. 如果你想要开箱了，双击运行 `get.exe`，并且输入 0，它会将 `out` 文件夹内的二人组汇总，并按照 类型分数-类型阈值 进行排序。如果输入 1 则表示输出含有评分的。会进行去重。

5\. 将得到的 `input.txt` 用 openbox 中的 cqp.exe 开箱即可。**开完箱记得将 `out` 文件夹内的东西全部删除，否则会混在一起！**

6\. 每隔一段时间放入新的号，重复以上过程即可。

7\. 和 node.exe 有一样的问题，windows 更新导致优先级为“正常”的程序无法跑满 cpu。你可以双击打开根目录下**和（不是或）** `Many` 目录下的 `priority.cmd` 来提速。

常见问题：

- 我运行完 out 里没有东西怎么回事？
  - 回去 check config.txt
- 我设错 config.txt 了！我想重新跑一遍已经入库的号的配队怎么办？
  - 清空除 input 之外的所有文件夹，再跑一遍。

### 原理解释

在核时代后，以 qp 为基础的原组队评价体系因数值膨胀与与真实比赛环境割裂彻底作废。

于是玩家群体组织开发了以不同二人组类型的按一定比例组成的真实强二人组（称为靶子），一个二人组与这些二人组对战的平均胜率称作 cqp。

但是这无法衡量单个号的组队强度。但是现在玩家群体已经大概摸清楚了强二人组的枚举方式：

- 背刺+配件；魅惑+配件；分身+分身配件；幻术+幻术配件；两个传统无刺（包括但不限于地裂瘟疫净化铁壁诅咒冰冻狂暴会心）（强的评价方式为：配地裂的强度）；

从而，可以通过现在玩家群体已经获得的每一种类型的强号，通过测单个号与这些号组队的 cqp 平均（准确地说，kmax sum），可以较为准确地得知这个号在这个领域的相对强度。

具体地，背刺核心的评分被称为 cp（刺评）；背刺配件被称为 fp（辅评）；无刺为 dp（地评）；分身与魅惑合称 fsp（分身评），等等。

但是测 cqp 是慢的。借鉴 xp，玩家【Squall】训练了简单的拟合模型来根据号的 43 维属性预测上文所提及的若干评分，均被称为 `s?p`，丝某评。

准确来说，预测的并非是上面的所说的评分，而是通过某种方式简化的版本，具体不解释了。总之，丝评越高，就越有概率实际上的评分强。

- 因为二人组存在加成，而加成的运作方式已经研究清楚，从而定义了“潜力丝评”，意思是，给这个号的某一个 name_base 更改为 63 后重新测丝评，取最大的那一种。（如果你没听懂，可以放弃理解）

data_structure 的运作方式是，取每一种类型（潜力）丝评较高的若干个号，按不同类型组合进行平方枚举，并取出两个号加成后对应评分和较大的二人组来测 cqp。

由于人海组的丝评并不那么准确，因此我们增加了测实际评的选项，这也是为什么 `Many` 目录下有个 `openbox` 文件夹。运作方式为对于分身/幻术号，测完丝评后将过筛的号拿去和实际的对应基准号组合测 1% cqp，并记录。最后在枚举二人组的时候，估算的分数为 实际测的评分-预测原来的评分+预测加成后的评分。分身配件和幻术配件我也设置了可以开启的选项（即 1 0 1 0 中的两个 0），但是非常不建议开启。

#### 其他想说的

时刻要注意，Data\_Structure 输出的分数仅有**筛子**作用，并不能看做类似拟合评分的东西。换而言之，你不应该只测前面几个二人组，发现不强，然后就放弃。

`Many` 目录下的 `priority.cmd` 应该在什么时候启动，我认为你应该已经可以自己推理出来了。但我还是说一下，这个 `cmd` 仅在 `Many` 内进行测实际评分的时候有效果，不过你提前开起来问题也不大。

`Regular` 目录下有一个 `readme.pdf`，不过是很早期只有 Regular 的时候写的，现在稍微修改了一下，懒得再给 `Many` 写一份对应的了。

## 2.4 一些小工具

也在 Tools 文件夹。和 1.7 的区别在于，这里介绍的工具大多是你阅读了第二章之后才理解它的意义和用法的。

### SP\_all

之前提到过的 SP，可以粗略地预测一个号作为某个类型的号的时候的评分。<br>
输入在 `input.txt` 里，每一行一个号然后换行。<br>
点开 `exe` 之后会有提示，让你输入一个数字，分别表示某一个种类的丝评，一共 7 种。同时输入 0 表示对超强单的预测。<br>
输入 8 则表示输出**所有比较高的**。这个比较高的有设定在程序内的一个阈值，你可以自行调整。也被称为“偷看器”，意思是在跑 ds 和测二人组之前先偷偷看看有没有看上去比较强的号。

输出在 `SP.txt` 里。格式为 `分数 号`。

### SP\_ptt

这个就是含有潜力值的 SP，之前提到过了。没有“偷看器”和超强单的预测。<br>
输入在 `input.txt` 里，每一行一个号然后换行。<br>
输出在 `SP_ptt.txt` 里。格式为 `原分数 潜力分数 号`。<br>

缺陷是，假如有些号有两个属性比较容易加成并且会带来比较大的提升，它只会选择相对而言提升更大的那个。

同时对于之前所说的

> 除此之外形如 x,y,x 的 name_base，其中 y 是一个很大的 name_base（比如 62 63 之类的）。这样的号在加成是会有一些妙妙性质使得他容易加成出更好的二人组，原因留作读者思考题。

这样的号，也会一定程度上低估。

### two\_score

这个是用来测二人组的指定评分的。

输入在 `input.txt` 里，每一行二人组，以`+`分隔然后换行。
输出在 `two_score.txt` 里。

```text
input 0 for type output(which will be helpful when you use ptt)
input 1 for normal score
input 2 for renhai score
Notice:input 0 can only recognize fc and wc. You need to check renhai type by yourself.
```
这个的作用是，根据你已有的二人组，测试各方面的评分，方便确定阈值。
